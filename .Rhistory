y = "Proportion Trampled Bare Ground"
) +
scale_fill_manual(
values = c("burro kills absent" = "cornflowerblue", "burro kills present" = "firebrick")
) +
scale_color_manual( # Add scale_color_manual for jitter points
values = c("burro kills absent" = "cornflowerblue", "burro kills present" = "firebrick")
) +
scale_x_discrete(
labels = c("burro kills absent" = "No", "burro kills present" = "Yes"),
expand = expansion(add = 0.5)
) +
theme_classic(base_size = 16) +
theme(
axis.text = element_text(color = "#6E7B8B", size = 14),
axis.title = element_text(color = "#6E7B8B", size = 14),
legend.position = "none",
axis.text.x = element_text(angle = 0, hjust = 0.5)
)
#| label: show_data - beyond_gaussian2
#| fig-width: 8
#| fig-height: 6
dat <- read.csv(here("data","Lundgren_Cougar_Burro_Trophic_Cascade_Trampled_BareGround.csv"))
dat <- dat %>%
dplyr::select(Site, Pool, if_kill, cover) %>%
mutate(Site=as.factor(Site),
if_kill=as.factor(if_kill),
cover=as.numeric(cover)
)
str(dat)
ggplot(dat, aes(x = if_kill, y = cover, fill = if_kill)) +
geom_violin(
aes(fill = if_kill), # Fill violins based on 'if_kill'
color = "#8B8B83", # Outline color for violins
width = 0.8,
alpha = 0.3,
position = position_dodge(width = 0.7)
) +
geom_jitter(
aes(color = if_kill), # Color jittered points based on 'if_kill'
size = 3,
alpha = 0.4,
shape = 1, # Open circles for jittered points
position = position_jitterdodge(dodge.width = 0.5, jitter.width = 0.15)
) +
stat_summary(
fun = mean,
geom = "crossbar",
width = 0.1,
color = "black", # Black crossbar for mean
linewidth = 0.5,
position = position_dodge(width = 0.7)
) +
labs(
title = "Donkey Trampling by Cougar Kill Presence",
x = "Cougar Kill Presence",
y = "Proportion Trampled Bare Ground"
) +
scale_fill_manual(
values = c("burro kills absent" = "cornflowerblue", "burro kills present" = "firebrick")
) +
scale_color_manual( # Add scale_color_manual for jitter points
values = c("burro kills absent" = "cornflowerblue", "burro kills present" = "firebrick")
) +
scale_x_discrete(
labels = c("burro kills absent" = "No", "burro kills present" = "Yes"),
expand = expansion(add = 0.5)
) +
theme_classic(base_size = 16) +
theme(
axis.text = element_text(color = "#6E7B8B", size = 14),
axis.title = element_text(color = "#6E7B8B", size = 14),
legend.position = "none",
axis.text.x = element_text(angle = 0, hjust = 0.5)
)
#| label: model_fitting1_results - beyond_gaussian2
#| echo: false
fit0 <- readRDS(here("Rdata", "fit0_BETA_Burros.rds"))
summary(fit0)
#| label: model_fitting2_results - beyond_gaussian2
#| echo: false
fit1 <- readRDS(here("Rdata", "fit1_BETA_Burros.rds"))
summary(fit1)
#| label: call new covariable  - eg1
dat<- dat%>%
dplyr::mutate(ST_DATE=scale(ST_DATE,center=T,scale = F))
#| label: model_fitting2 - model2 - glmmtmb  - eg1
model2_2 <- glmmTMB(
log(SMI) ~ 1 + RANK + (1|NEST)+(1|WORKYEAR),
dispformula = ~ 1 + RANK,
data = dat,
family = gaussian
)
#| label: model_fitting2 add new covariable  - eg1
model2_3a <- glmmTMB(
log(SMI) ~ 1 + RANK + ST_DATE + (1|NEST)+(1|WORKYEAR),
dispformula = ~ 1 + RANK,
data = dat,
family = gaussian
)
#| label: model_fitting2 interaction  - eg1
model2_3b<- glmmTMB(
log(SMI) ~ 1 + RANK + ST_DATE + RANK*ST_DATE +(1|NEST)+(1|WORKYEAR),
dispformula = ~ 1 + RANK,
data = dat,
family = gaussian
)
pacman::p_load(
## data manipulation
dplyr, tibble, tidyverse, broom, broom.mixed,
## model fitting
ape, arm, brms, broom.mixed, cmdstanr, emmeans, glmmTMB, MASS, phytools, rstan, TreeTools,
## model checking and evaluation
DHARMa, loo, MuMIn, parallel,
## visualisation
bayesplot, ggplot2, patchwork, tidybayes,
## reporting and utilities
gt, here, kableExtra, knitr
)
packageVersion("brms")
rstan::stan_version()
detach("package:rstan", unload = TRUE)
install.packages("rstan", type = "source")
rstan::stan_version()
pacman::p_load(
## data manipulation
dplyr, tibble, tidyverse, broom, broom.mixed,
## model fitting
ape, arm, brms, broom.mixed, cmdstanr, emmeans, glmmTMB, MASS, phytools, rstan, TreeTools,
## model checking and evaluation
DHARMa, loo, MuMIn, parallel,
## visualisation
bayesplot, ggplot2, patchwork, tidybayes,
## reporting and utilities
gt, here, kableExtra, knitr
)
# load the dataset ----
dat_pref <- read.csv(here("data", "AM_preference.csv"), header = TRUE)
dat_pref <- dat_pref %>%
dplyr::select(-stripe, -full, -subset) %>%
rename(frequency = dot) %>%
mutate(species = phylo, across(c(condition, sex), as.factor))
#| label: model_cmp_brms
max_cores <- 10
num_chains <- 2
threads_per_chain <- floor(max_cores / num_chains)
options(mc.cores = num_chains)
formula <- bf(
frequency ~ 1 + condition + sex + (1 | species) + (1 | id),
shape ~ 1 + condition + sex
)
prior <- default_prior(formula,
data = dat_pref,
family = brmsfamily("com_poisson")
)
system.time(model_nb_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 2000,
warmup = 1000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson"),
backend = "cmdstanr"
# control = list(adapt_delta = 0.95)
)
)
summary(model_nb_brms)
model_2 <- glmmTMB(
frequency ~ 1 + condition + sex + (1 | species) + (1 | id),
dispformula = ~ condition + sex,
data = dat_pref,
family = compois(link = "log")
)
summary(model_2)
confint(model_2)
formula <- bf(
frequency ~ 1 + condition + sex + (1 | species) + (1 | id),
shape ~ 1 + condition + sex
)
stancode <- make_stancode(
formula,
data = dat_pref,
family = brmsfamily("com_poisson")
)
cat(stancode)
?family_glmmTMB
fixef(model_nb_brms)
getS3method("family", "compois")
glmmTMB::family_params(compois())
formula <- bf(
frequency ~ 1 + condition + sex + (1 | species) + (1 | id),
shape ~ 1 + condition + sex
)
stancode <- make_stancode(
formula,
data = dat_pref,
family = brmsfamily("com_poisson")
)
cat(stancode)
fixef(model_2)$disp
exp(fixef(model_2)$disp)
?compois
str(compois())
exp(0.09)
system.time(model_CMP_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 2000,
warmup = 1000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson"),
backend = "cmdstanr"
control = list(adapt_delta = 0.95, max_treedepth = 15)
system.time(
model_CMP_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 2000,
warmup = 1000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson"),
backend = "cmdstanr",
control = list(adapt_delta = 0.95, max_treedepth = 15)
)
)
system.time(
model_CMP_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 4000,
warmup = 2000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson"),
backend = "cmdstanr",
control = list(adapt_delta = 0.95, max_treedepth = 15)
)
)
system.time(
model_CMP_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 4000,
warmup = 2000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson"),
backend = "cmdstanr",
control = list(adapt_delta = 0.95, max_treedepth = 15)
)
)
quarto::quarto_render(input = ".")
quarto::quarto_render(input = ".")
getwd()
setwd("/Users/pancho/Library/CloudStorage/GoogleDrive-amizuno@ualberta.ca/My Drive/Eco_location-scale_model/Rev_tutorial_qmd")
quarto::quarto_render(input = ".")
model_2 <- readRDS(here("Rdata", "model_CMP_AM.rds"))
summary(model_2)
confint(model_2)
system.time(
model_CMP_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 4000,
warmup = 2000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson")
backend = "cmdstanr",
system.time(
model_CMP_brms <- brm(formula,
data = dat_pref,
prior = prior,
chains = num_chains,
iter = 4000,
warmup = 2000,
thin = 1,
threads = threading(threads_per_chain),
family = brmsfamily("com_poisson"),
backend = "cmdstanr",
control = list(adapt_delta = 0.95, max_treedepth = 15)
)
)
quarto::quarto_render(input = ".")
pacman::p_load(
## data manipulation
dplyr, tibble, tidyverse, broom, broom.mixed,
## model fitting
ape, arm, brms, broom.mixed, cmdstanr, emmeans, glmmTMB, MASS, phytools, rstan, TreeTools,
## model checking and evaluation
DHARMa, loo, MuMIn, parallel,
## visualisation
bayesplot, ggplot2, patchwork, tidybayes,
## reporting and utilities
gt, here, kableExtra, knitr
)
dat_tarsus <- read.csv(here("data", "SparrowTarsusData.csv"), header = TRUE)
dat_BFB <- read_csv(here("data","SMI_Drummond_et_al_2025.csv")) %>%subset(REDUCTION == 0)
dat_pref <- read.csv(here("data", "AM_preference.csv"), header = TRUE)
dat_Cougar <- read.csv(here("data","Lundgren_Cougar_Burro_Trophic_Cascade_Trampled_BareGround.csv"))
tree <- read.nexus(here("data", "AM_est_tree.txt"))
tree　<-force.ultrametric(tree, method = "extend")
tip <- c("Lonchura_cantans","Uraeginthus_bengalus","Neochmia_modesta",
"Lonchura_atricapilla","Padda_oryzivora","Taeniopygia_bichenovii",
"Emblema_pictum","Neochmia_ruficauda","Lonchura_maja",
"Taeniopygia_guttata","Chloebia_gouldiae","Lonchura_castaneothorax")
pref_tree <- KeepTip(tree, tip, preorder = TRUE, check = TRUE)
remove(tree)
remove(tip)
files <- list.files(path = "data/", pattern = "\\.csv$", full.names = TRUE)
data_list <- lapply(files, read.csv)
names(data_list) <- tools::file_path_sans_ext(basename(files))
save(data_list, file = "all_data.RData")
load("all_data.RData")
load(here("repro_package", "all_data.RData"))
load(here("repro_package", "all_data.RData"))
dat_1 <- data_list$SparrowTarsusData
View(data_list)
quarto render
quarto::quarto_render()
quarto::quarto_render()
quarto::quarto_render()
quarto::quarto_render()
getwd()
list.files(all.files = TRUE)
file.exists("_quarto.yml")
# まず中に本当に _quarto.yml があるか確認
list.files("Rev_tutorial_qmd", all.files = TRUE)
# サブフォルダを指定してレンダー
quarto::quarto_render("Rev_tutorial_qmd")
# プレビューしたい場合
quarto::quarto_preview("Rev_tutorial_qmd")
# Make single RData file containing all datasets and scripts used in the repro package ----
dat_tarsus <- read.csv(here("data", "SparrowTarsusData.csv"), header = TRUE)
dat_BFB <- read_csv(here("data","SMI_Drummond_et_al_2025.csv"))
dat_pref <- read.csv(here("data", "AM_preference.csv"), header = TRUE)
dat_Cougar <- read.csv(here("data","Lundgren_Cougar_Burro_Trophic_Cascade_Trampled_BareGround.csv"))
tree <- read.nexus(here("data", "AM_est_tree.txt"))
tree　<-force.ultrametric(tree, method = "extend")
tip <- c("Lonchura_cantans","Uraeginthus_bengalus","Neochmia_modesta",
"Lonchura_atricapilla","Padda_oryzivora","Taeniopygia_bichenovii",
"Emblema_pictum","Neochmia_ruficauda","Lonchura_maja",
"Taeniopygia_guttata","Chloebia_gouldiae","Lonchura_castaneothorax")
pref_tree <- KeepTip(tree, tip, preorder = TRUE, check = TRUE)
remove(tip)
all_data <- list(
dat_tarsus = dat_tarsus,
dat_BFB    = dat_BFB,
dat_pref   = dat_pref,
dat_Cougar = dat_Cougar,
pref_tree  = pref_tree
)
save(all_data, file = here("data", "all_datasets_and_tree.RData"))
load(here("data", "all_datasets_and_tree.RData"))
names(all_data)
save(all_data, file = here("data", "all_data.RData"))
load(here("repro_package", "all_data.RData"))
dat_tarsus <-
names(all_data)
names(all_data)
dat_tarsus <- all_data$dat_tarsus
View(all_data)
dat <- data_list$dat_BFB
data_list$dat_pref
dat_pref <- data_list$dat_pref
load(here("repro_package", "all_data.RData"))
dat_pref <- data_list$dat_pref
load(here("repro_package", "all_data.RData"))
dat_pref <- data_list$dat_pref
all_data <- list(
dat_tarsus = dat_tarsus,
dat_BFB    = dat_BFB,
dat_pref   = dat_pref,
dat_Cougar = dat_Cougar,
pref_tree  = pref_tree
)
# Make single RData file containing all datasets and scripts used in the repro package ----
dat_tarsus <- read.csv(here("data", "SparrowTarsusData.csv"), header = TRUE)
dat_BFB <- read_csv(here("data","SMI_Drummond_et_al_2025.csv"))
dat_pref <- read.csv(here("data", "AM_preference.csv"), header = TRUE)
dat_Cougar <- read.csv(here("data","Lundgren_Cougar_Burro_Trophic_Cascade_Trampled_BareGround.csv"))
tree <- read.nexus(here("data", "AM_est_tree.txt"))
tree　<-force.ultrametric(tree, method = "extend")
tip <- c("Lonchura_cantans","Uraeginthus_bengalus","Neochmia_modesta",
"Lonchura_atricapilla","Padda_oryzivora","Taeniopygia_bichenovii",
"Emblema_pictum","Neochmia_ruficauda","Lonchura_maja",
"Taeniopygia_guttata","Chloebia_gouldiae","Lonchura_castaneothorax")
pref_tree <- KeepTip(tree, tip, preorder = TRUE, check = TRUE)
remove(tip)
remove(tree)
all_data <- list(
dat_tarsus = dat_tarsus,
dat_BFB    = dat_BFB,
dat_pref   = dat_pref,
dat_Cougar = dat_Cougar,
pref_tree  = pref_tree
)
save(all_data, file = here("data", "all_data.RData"))
dat <- data_list$dat_BFB
dat
load(here("repro_package", "all_data.RData"))
# names(all_data)
dat_tarsus <- all_data$dat_tarsus
all_data <- list(
dat_tarsus = dat_tarsus,
dat_BFB    = dat_BFB,
dat_pref   = dat_pref,
dat_Cougar = dat_Cougar,
pref_tree  = pref_tree
)
# Make single RData file containing all datasets and scripts used in the repro package ----
dat_tarsus <- read.csv(here("data", "SparrowTarsusData.csv"), header = TRUE)
dat_BFB <- read_csv(here("data","SMI_Drummond_et_al_2025.csv"))
dat_pref <- read.csv(here("data", "AM_preference.csv"), header = TRUE)
dat_Cougar <- read.csv(here("data","Lundgren_Cougar_Burro_Trophic_Cascade_Trampled_BareGround.csv"))
tree <- read.nexus(here("data", "AM_est_tree.txt"))
tree　<-force.ultrametric(tree, method = "extend")
tip <- c("Lonchura_cantans","Uraeginthus_bengalus","Neochmia_modesta",
"Lonchura_atricapilla","Padda_oryzivora","Taeniopygia_bichenovii",
"Emblema_pictum","Neochmia_ruficauda","Lonchura_maja",
"Taeniopygia_guttata","Chloebia_gouldiae","Lonchura_castaneothorax")
pref_tree <- KeepTip(tree, tip, preorder = TRUE, check = TRUE)
remove(tip)
remove(tree)
files <- list.files(path = "data/", pattern = "\\.csv$", full.names = TRUE)
all_data <- list(
dat_tarsus = dat_tarsus,
dat_BFB    = dat_BFB,
dat_pref   = dat_pref,
dat_Cougar = dat_Cougar,
pref_tree  = pref_tree
)
save(all_data, file = here("data", "all_data.RData"))
save(dat_tarsus, dat_BFB, dat_pref, dat_Cougar, pref_tree,
file = here("data", "all_data.RData"))
# 読み込み後はそのまま使える
load(here("data", "all_data.RData"))
dat <- dat_BFB
# Make single RData file containing all datasets and scripts used in the repro package ----
dat_tarsus <- read.csv(here("data", "SparrowTarsusData.csv"), header = TRUE)
dat_BFB <- read_csv(here("data","SMI_Drummond_et_al_2025.csv"))
dat_pref <- read.csv(here("data", "AM_preference.csv"), header = TRUE)
dat_Cougar <- read.csv(here("data","Lundgren_Cougar_Burro_Trophic_Cascade_Trampled_BareGround.csv"))
tree <- read.nexus(here("data", "AM_est_tree.txt"))
tree　<-force.ultrametric(tree, method = "extend")
# is.ultrametric(tree)
tip <- c("Lonchura_cantans","Uraeginthus_bengalus","Neochmia_modesta",
"Lonchura_atricapilla","Padda_oryzivora","Taeniopygia_bichenovii",
"Emblema_pictum","Neochmia_ruficauda","Lonchura_maja",
"Taeniopygia_guttata","Chloebia_gouldiae","Lonchura_castaneothorax")
pref_tree <- KeepTip(tree, tip, preorder = TRUE, check = TRUE)
remove(tip)
remove(tree)
## save the data into a single RData file
save(dat_tarsus, dat_BFB, dat_pref, dat_Cougar, pref_tree,
file = here("data", "all_data.RData"))
# 読み込み後はそのまま使える
load(here("data", "all_data.RData"))
# 読み込み後はそのまま使える
all_data <- load(here("data", "all_data.RData"))
dat <- all_data$dat_tarsus
# 読み込み後はそのまま使える
all_data <- load(here("data", "all_data.RData"))
load(here("repro_package", "all_data.RData"))
load(here("repro_package", "all_data.RData"))
## save the data into a single RData file
# 一度作ったデータをまとめる
all_data <- list(
dat_tarsus = dat_tarsus,
dat_BFB    = dat_BFB,
dat_pref   = dat_pref,
dat_Cougar = dat_Cougar,
pref_tree  = pref_tree
)
# RDataに保存
save(all_data, file = here("repro_package", "all_data.RData"))
load(here("repro_package", "all_data.RData"))
load(here("repro_package", "all_data.RData"))
dat_tarsus <- all_data$dat_tarsus
dat <- all_data$dat_BFB %>%subset(REDUCTION == 0)
quarto::quarto_render()
quarto::quarto_path()
getwd()
list.files(all.files = TRUE)
file.exists("_quarto.yml")
setwd("~/Library/CloudStorage/GoogleDrive-amizuno@ualberta.ca/My Drive/Eco_location-scale_model")
setwd("~/Library/CloudStorage/GoogleDrive-amizuno@ualberta.ca/My Drive/Eco_location-scale_model")
quarto::quarto_render()
View(all_data)
# Load required packages ----
pacman::p_load(
dplyr, tibble, tidyverse, broom, broom.mixed,
ape, arm, brms, broom.mixed, cmdstanr, emmeans, glmmTMB, MASS, phytools, rstan, TreeTools,
DHARMa, loo, MuMIn, parallel, ggeffects,
bayesplot, ggplot2, patchwork, tidybayes,
gt, here, kableExtra, knitr
)
load(here("repro_package", "all_data.RData"))
####
# Model 1 ----
####
dat_tarsus <- all_data$dat_tarsus
ls()
